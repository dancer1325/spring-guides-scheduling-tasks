:toc:
:spring_version: current
:icons: font
:source-highlighter: prettify
:project_id: gs-scheduling-tasks
:build_name: gs-scheduling-tasks
:build_version: 0.0.1-SNAPSHOT
:build_system: gradle
:java_version: 17
:spring_academy_available: n
:spring_academy_url:

* goal
    ** scheduling tasks with Spring

== What You Will Build

* application / prints out the current time / 5 seconds
    ** -- via -- Spring Framework's https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Scheduled.html[`@Scheduled`^]

// required: {java_version}, {project_id}
include::guide_intro.adoc[]

[[scratch]]
== Starting with Spring Initializr

* ways to use
    ** use this https://start.spring.io/#!type=gradle-project&language=java&packaging=jar&groupId=com.example&artifactId=scheduling-tasks&name=scheduling-tasks&description=Demo%20project%20for%20Spring%20Boot&packageName=com.example.scheduling-tasks[pre-initialized project^] / contains naming & required dependendencies
        *** click Generate -- to download a -- ZIP file
    ** manually
        *** Navigate to https://start.spring.io[https://start.spring.io^]
            **** Choose either Gradle or Maven & the language you want to use
            **** Click *Generate*
            **** Download the resulting ZIP file
        *** if your IDE -- has the -- Spring Initializr integration -> same steps as before

== Enable Scheduling

* scheduled tasks
    ** can be embedded | web applications
    ** creates a standalone application
        *** simpler approach -- ðŸ‘€used here ðŸ‘€ --
        *** -> ðŸ‘€package everything in 1! executable JAR file / driven by a Java main() method ðŸ‘€
====
[source,java]
----
@SpringBootApplication
@EnableScheduling
public class SchedulingTasksApplication {
----
====

* `@EnableScheduling`
    ** enables Spring's scheduled task execution capability

== Create a Scheduled Task

====
[source,java]
----
@Component
public class ScheduledTasks {

	private static final Logger log = LoggerFactory.getLogger(ScheduledTasks.class);

	private static final SimpleDateFormat dateFormat = new SimpleDateFormat("HH:mm:ss");

	@Scheduled(fixedRate = 5000)
	public void reportCurrentTime() {
		log.info("The time is now {}", dateFormat.format(new Date()));
	}
}
----
====

* https://docs.spring.io/spring-framework/reference/integration/scheduling.html#scheduling-annotation-support-scheduled[`Scheduled` annotation^]
    ** | method /
        *** ðŸ‘€defines when a particular method runs ðŸ‘€
    ** https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Scheduled.html#fixedRate()[`fixedRate()`^]
        *** specifies the interval between method invocations
        *** alternatives
            **** https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Scheduled.html#cron()[`cron()`^]
            **** https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Scheduled.html#fixedDelay()[`fixedDelay()`^]
    ** https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Scheduled.html#initialDelay()[`initialDelay()`^]
        *** optional
        *** | 1-time task

== Running the Application

====
----
./gradlew bootRun
----
====

method / annotated with @Scheduled runs -> starts to print out

====
----
20yy-mm-ddT07:23:01.665-04:00  INFO 19633 --- [   scheduling-1] c.e.schedulingtasks.ScheduledTasks       : The time is now 07:23:01
20yy-mm-ddT07:23:06.663-04:00  INFO 19633 --- [   scheduling-1] c.e.schedulingtasks.ScheduledTasks       : The time is now 07:23:06
20yy-mm-ddT07:23:11.663-04:00  INFO 19633 --- [   scheduling-1] c.e.schedulingtasks.ScheduledTasks       : The time is now 07:23:11
----
====

== Testing with the awaitility Dependency

* https://github.com/awaitility/awaitility[`awaitility` library^]
    ** allows
        *** testing your application
    ** -- managed by -- Spring Boot v3.2+
    ** _Example:_ next test -- is run automatically via -- `./gradlew clean build`

====
[source,java]
----
@SpringBootTest
public class ScheduledTasksTest {

	@SpyBean
	ScheduledTasks tasks;

	@Test
	public void reportCurrentTime() {
		await().atMost(Durations.TEN_SECONDS).untilAsserted(() -> {
			verify(tasks, atLeast(2)).reportCurrentTime();
		});
	}
}
----
====

== See Also

The following guides may also be helpful:

* https://spring.io/guides/gs/spring-boot/[Building an Application with Spring Boot^]
* https://spring.io/guides/gs/batch-processing/[Creating a Batch Service^]

include::https://raw.githubusercontent.com/spring-guides/getting-started-macros/main/footer.adoc[]
